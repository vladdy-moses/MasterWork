\section{Описание экспериментов}

\subsection{Нагрузочное тестирование веб-сервиса платежей ГИС ЖКХ}
\label{expGis}
\subsubsection*{Цели и задачи эксперимента}

Целью данного вычислительного эксперимента является проверка корректности работы веб-сервиса регистрации платежей (фактов оплат) ГИС ЖКХ в момент пиковых нагрузок.

Данная цель достигается при помощи следующих задач:
\begin{easylist}
& внедрение механизма мониторинга времени обработки сообщений в ГИС ЖКХ для платёжного веб-сервиса;
& получение от заказчиков контрольных значений по пиковым нагрузкам их биллинговых систем;
& получение платежей (фактов оплат) в РИАС ЖКХ и их последующая отправка в ГИС ЖКХ в момент пиковой нагрузки;
& сбор и обработка полученных временных интервалов обработки пакетов фактов оплат и аппроксимация результатов для большего числа платежей.
\end{easylist}

\subsubsection*{Исходные данные}

Время и продолжительность пика оплат за ЖКХ с 10:00 до 14:00.
В это время происходит свыше половины фактов оплат.
Каждую минуту от заказчика приходит в среднем около 120 платежей.
Наибольший поток платежей за 2017 год был зарегистрирован 27 февраля 2017 года в 14:03 и составил 533 платежа в минуту.

По требованию приказа №~74/114/пр~\cite{pr74114} и технического задания на РИАС ЖКХ время отправки факта оплаты от его совершения до конца его регистрации в ГИС ЖКХ должно составлять 2 часа.

Необходимо узнать, будет ли превышен указанный интервал в конце пиковой нагрузки.

\subsubsection*{План эксперимента}

\begin{enumerate}
	\item сбор данных о пиковых нагрузках. На этом этапе необходимо выяснить у заказчика (или разработчика его биллинговой системы), в какие промежутки времени происходит самый большой поток оплат за услуги ЖКХ;
	\item разработка и внедрение механизма мониторинга времени обработки запроса в ГИС ЖКХ;
	\item получение фактов оплат от заказчика при пиковой нагрузке;
	\item регистрация фактов оплат в ГИС ЖКХ. На данном шаге следует отметить, что факты оплат в ГИС ЖКХ регистрируются пакетами от 1 до 1000 штук. Здесь следует отправить пакеты по 1000 платежей (пик), а также и более мелкие пакеты (полупик) для выявления зависимости числа времени обработки пакета от числа платежей в нём;
	\item моделирование и аппроксимация полученных задержек регистрации платежей на весь период пика. На данном шаге вычисляется максимальная задержка платежа под конец пиковой нагрузки;
	\item составление выводов о корректности работы веб-сервиса ГИС ЖКХ.
\end{enumerate}

\subsubsection*{Выполнение эксперимента}

Платежи были перенесены в очередь передачи в ГИС ЖКХ и сохранены в хранилище данных РИАС ЖКХ.
Дальнейшая обработка данных и их передача в ГИС ЖКХ проводилась в автоматическом режиме модулем интеграции РИАС ЖКХ с ГИС ЖКХ, как если бы эти данные приходили в платёжный шлюз от систем заказчика в обычном режиме работы.

Платежи отправлялись в ГИС ЖКХ порциями от 1 до 1\,000 записей за раз. 

Результаты передачи данных и время реагирования ГИС ЖКХ приведены в таблице~\ref{tab:exp-gisapi-send}.

\begin{myTable}
\begin{longtable}[h]{|p{0.25\textwidth}|p{0.25\textwidth}|p{0.25\textwidth}|p{0.15\textwidth}|}
	\caption{\label{tab:exp-gisapi-send}Результаты передачи данных и время реагирования ГИС ЖКХ} \\
	\hline
		\multirow{2}{*}{\thead{Количество платежей\\в запросе}} &
		\multicolumn{3}{c|}{\thead{Дата и время}} \\
	\cline{2-4}
		&
		\thead{Запроса} &
		\thead{Ответа} &
		\thead{Дельта, сек} \\
	\hline
		\theadnum{1} & \theadnum{2} & \theadnum{3} & \theadnum{4} \\
	\hline \endfirsthead
	\hline
		\theadnum{1} & \theadnum{2} & \theadnum{3} & \theadnum{4} \\
	\hline \endhead
		21     & 2017-05-28 20:15:22 & 2017-05-28 20:15:23 & 1  \\ \hline
		60     & 2017-05-28 17:55:34 & 2017-05-28 17:55:37 & 3  \\ \hline
		71     & 2017-05-28 17:18:00 & 2017-05-28 17:18:04 & 4  \\ \hline
		88     & 2017-05-28 14:04:12 & 2017-05-28 14:04:18 & 6  \\ \hline
		148    & 2017-05-27 19:33:13 & 2017-05-27 19:33:17 & 3  \\ \hline
		221    & 2017-05-27 18:39:00 & 2017-05-27 18:39:06 & 6  \\ \hline
		265    & 2017-05-27 18:28:06 & 2017-05-27 18:28:15 & 9  \\ \hline
		317    & 2017-05-27 17:06:29 & 2017-05-27 17:06:43 & 14 \\ \hline
		362    & 2017-05-27 17:28:15 & 2017-05-27 17:28:26 & 11 \\ \hline
		416    & 2017-05-27 15:55:45 & 2017-05-27 15:56:07 & 22 \\ \hline
		485    & 2017-05-27 15:06:35 & 2017-05-27 15:06:52 & 17 \\ \hline
		511    & 2017-05-27 13:39:14 & 2017-05-27 13:39:38 & 24 \\ \hline
		566    & 2017-05-26 17:26:26 & 2017-05-26 17:26:43 & 17 \\ \hline
		611    & 2017-05-26 12:53:16 & 2017-05-26 12:53:43 & 27 \\ \hline
		676    & 2017-05-26 12:31:22 & 2017-05-26 12:31:58 & 36 \\ \hline
		727    & 2017-05-25 10:53:13 & 2017-05-25 10:53:48 & 35 \\ \hline
		784    & 2017-05-24 18:00:57 & 2017-05-24 18:01:38 & 41 \\ \hline
		838    & 2017-05-24 19:06:48 & 2017-05-24 19:07:35 & 47 \\ \hline
		897    & 2017-05-24 19:28:44 & 2017-05-24 19:29:26 & 42 \\ \hline
		985    & 2017-05-24 19:50:42 & 2017-05-24 19:51:20 & 38 \\ \hline
		1\,000 & 2017-05-26 07:32:00 & 2017-05-26 07:32:49 & 49 \\ \hline
\end{longtable}
\end{myTable}

График зависимости времени обработки пакета платежей от количества записей в пакете изображён на рисунке~\ref{img:exp-gisapi-test}.

\myFigure[t]{0.8}{exp-gisapi-test}{График зависимости времени обработки пакета платежей от количества записей в пакете с линией линейного тренда}

\subsubsection*{Ожидаемые и полученные результаты}

Ожидается, что веб-сервис ГИС ЖКХ будет обрабатывать более 1\,000 платежей в минуту.
Скорость обработки пакета платежей должна линейно возрастать по отношению к количеству фактов оплат в пакете.

По результатам вычислительного эксперимента скорость обработки платежей в ГИС ЖКХ составила в среднем 1\,466 платежей (фактов оплат) в минуту.
Возрастание скорости обработки в зависимости от элементов в пакете проявляет линейную зависимость.

\subsubsection*{Выводы}

ГИС ЖКХ регистрирует платежи со скоростью, позволяющей иметь запас по пиковым нагрузкам заказчика более чем в 2 раза.
Линейная зависимость при формировании пакетов данных свидетельствует о том, что формирование крупных пакетов (с количеством платежей около предельных значений) выгодна только благодаря накладным расходам на их формирование в РИАС ЖКХ и благодаря затратам на установку зашифрованного канала связи между РИАС ЖКХ и ГИС ЖКХ.

\subsection{Нагрузочное тестирование веб-сервиса платежей РИАС ЖКХ}

\subsubsection*{Цели и задачи эксперимента}

Данный эксперимент связан с экспериментом по нагрузочному тестированию веб-сервиса платежей ГИС ЖКХ, описанном в п.~\ref{expGis}.

Целью данного эксперимента является проверка корректности веб-сервиса РИАС ЖКХ по регистрации фактов оплат от биллинговых систем заказчиков (т.н. <<платёжный шлюз>>) и подсистемы обработки платежей РИАС ЖКХ для их дальнейшей отправки в ГИС ЖКХ.

Задачи эксперимента:
\begin{easylist}
& сбор сведений о предельной скорости регистрации фактов оплат в РИАС ЖКХ;
& сбор сведений о скорости обработки фактов оплат для их последующей отправки в ГИС ЖКХ;
& сопоставление полученных данных со скоростью обработки платежей в ГИС ЖКХ (более подробно описано в п.~\ref{expGis}).
\end{easylist}

\subsubsection*{Исходные данные}

Было получено разрешение от одного из заказчиков провести данный эксперимент на промышленных стендах РИАС ЖКХ и ГИС ЖКХ в рамках нагрузочных испытаний РИАС ЖКХ.

Также из отчёта о нагрузочном тестировании биллинговой системы заказчика известно, что данная система способна регистрировать до 120\,000 фактов оплат в час (2\,000 в минуту).
Из п.~\ref{expGis} известно, что ГИС ЖКХ может обрабатывать до 1\,466 фактов оплат в минуту.

\subsubsection*{План эксперимента}

\begin{enumerate}
	\item согласование с заказчиком времени и продолжительности проведения нагрузочного тестирования;
	\item настройка РИАС ЖКХ для проведения нагрузочного тестирования веб-сервиса платежей;
	\item разработка программного обеспечения для проверки времени ответа веб-сервиса платежей РИАС ЖКХ;
	\item сбор статистики по времени ответа веб-сервиса платежей РИАС ЖКХ;
	\item сбор статистики по времени обработки фактов оплат для их отправки в ГИС ЖКХ;
	\item сопоставление полученных данных с исходными;
	\item составление выводов.
\end{enumerate}

\subsubsection*{Выполнение эксперимента}

Для проведения нагрузочного тестирования на промышленном стенде заказчика в ночное время был развёрнут тестовый эксземпляр веб-сервиса по приёму платежей (фактов оплат).

Затем на платформе Microsoft Visual Studio был разработан нагрузочный тест, который параллельно в заданное число потоков отправлял запросы на регистрацию платежей.
Конфигурация нагрузочного теста представлена в таблице~\ref{tab:exp-riasapi-config}.

\begin{myTable}
\begin{longtable}[h]{|p{0.3\textwidth}|p{0.6\textwidth}|}
	\caption{\label{tab:exp-riasapi-config}Конфигурация нагрузочного теста для проведения испытаний платёжного шлюза} \\
	\hline
		\thead{Параметр} &
		\thead{Значение} \\
	\hline
		\theadnum{1} & \theadnum{2} \\
	\hline \endfirsthead
	\hline
		\theadnum{1} & \theadnum{2} \\
	\hline \endhead
		ПО веб-сервиса & IIS Express \\ \hline
		Количество одновременных клиентов API & 10 \\ \hline
		Метод API & SendOrderInfoAgent (регистрация факта оплаты платёжным агентом) \\ \hline
		Время тестирования & 5 минут \\ \hline
		Конфигурация веб-сервиса & Release \\ \hline
\end{longtable}
\end{myTable}

Снимок экрана с загрузкой процессора и оперативной памяти представлен на рисунке~\ref{img:exp-riasapi-test}.

Иные показатели результата нагрузочного теста представлены на рисунке~\ref{img:exp-riasapi-test-other}.

\myFigure[t]{0.6}{exp-riasapi-test}{Снимок экрана с загрузкой процессора и оперативной памяти. ЦП -- красным, ОЗУ -- зелёным}

\myFigure[t]{0.9}{exp-riasapi-test-other}{Иные показатели результата нагрузочного теста}

\subsubsection*{Ожидаемые и полученные результаты}

Ожидается, что веб-сервис РИАС ЖКХ будет обрабатывать более 1\,000 платежей в минуту.
Процент ошибок должен быть менее 0,3\%.

По результатам нагрузочного теста платёжный шлюз РИАС ЖКХ смог обработать за 5 минут 21\,830 платежей (4\,366 в минуту), что больше ожидаемого результата в 4 раза.
Ошибок было зарегистрировано 0, что меньше ожидаемого результата.

\subsubsection*{Выводы}

Платёжный шлюз РИАС ЖКХ, развёрнутый на площадке заказчика, успешно справляется с пиковыми нагрузками и имеет запас по скорости регистрации и обработки фактов оплат и не требует проведения дополнительной оптимизации программного обеспечения и улучшения аппаратного обеспечения серверов.

\subsection{Сравнение скорости передачи данных различными методами обмена}
\label{ext-echange}

\subsubsection*{Цели и задачи эксперимента}

Целью данного вычислительного эксперимента является составление общего и максимально полного понимания характеристик передачи данных при использовании методов информационного обмена, используемых в РИАС ЖКХ.

Цель достигается при помощи следующих задач:
\begin{easylist}
& выделение основных типовых видов информации, по которым осуществляется информационный обмен;
& разработка тестового стенда для проверки различных методов информационного взаимодействия;
& выполнение нагрузочных испытаний и сбор статистических данных для последующей их обработки;
& формирование выводов, на каких типичных данных какой метод информационного взаимодействия использовать целесообразнее.
\end{easylist}

\subsubsection*{Исходные данные}

Существует три типовых вида информации:
\begin{easylist}
& много записей с малым числом данных (например, показания приборов учёта);
& записи с большим числом данных (например, сведения об общедомовом приборе учёта);
& записи с вложенными множественными данными (например, платёжный документ со списком начислений по каждой услуге).
\end{easylist}


\subsubsection*{План эксперимента}

\begin{enumerate}
	\item выбор площадки для проведения эксперимента;
	\item генерация данных;
	\item написание прикладного ПО, позволяющее проводить информационный обмен;
	\item проведение измерений скорости, времени и объёма передаваемой информации;
	\item формирование графиков;
	\item составление выводов.
\end{enumerate}

\subsubsection*{Выполнение эксперимента}

Протокол проведения вычислительного эксперимента:

\textbf{TestSmall [2017-06-06 20:00]}

Записей: 2 174 410.

Значащих полей: 3.

Размер таблицы: 71.38 Мб (индексов 21.38 Мб).

\textit{Прямой обмен}.
Время передачи (секунд): 60, 63, 57, 55, 63 (среднее 59.6).

Использование C\# EF6.
Время вычитывания из БД (секунд): 55, 43, 47, 42, 47 (среднее 46.8).

Скорость передачи информации: 5.2 Мб/с.

\textit{Реестры}.
Объём выгрузки: 92.60 Мб.
Формирование (секунд): 55, 64, 86, 54, 75 (среднее 66.8).

\textit{REST}.
Объём выгрузки: 177.46 Мб.
Формирование (секунд): 56, 79, 79, 72, 74 (среднее 72.0).

\textit{SOAP}.
Объём выгрузки: 329.25 Мб.
Формирование (секунд): 65, 74, 79, 78, 78 (среднее 75.0).

~

\textbf{TestLarge [2017-06-06 21:00]}

Записей: 434 890.

Значащих полей: 15.

Размер таблицы: 168.88 Мб (индексов 0.65 Мб).

\textit{Прямой обмен}.
Время передачи (секунд): 98, 73, 58, 70, 55 (среднее 70.8).

Использование C\# EF6.
Время вычитывания из БД (секунд): 19, 16, 18, 19, 19 (среднее 18.2).

Скорость передачи информации: 5.2 Мб/с.
	
\textit{Реестры}.
Объём выгрузки: 157.79 Мб.
Формирование (секунд): 25, 26, 23, 25, 23 (среднее 24.4).

\textit{REST}.
Объём выгрузки: 221.31 Мб.
Формирование (секунд): 29, 26, 30, 29, 26 (среднее 28.0).

\textit{SOAP}.
Объём выгрузки: 290.24 Мб.
Формирование (секунд): 29, 28, 28, 27, 29 (среднее 28.2).

~

\textbf{TestMany [2017-06-06 23:00]}

Записей: 108 724 + 1 087 240 * 2.

Значащих полей: 15.

Размер таблиц: 124.89 Мб (индексов 30.40 Мб).

\textit{Прямой обмен}.
Время передачи (секунд): 35, 35, 49 , 40, 47 (среднее 41.2).

Использование C\# EF6.
Время вычитывания из БД (секунд): 273, 337, 343, 250, 264 (среднее 293.4).

Скорость передачи информации: 5.2 Мб/с.

\textit{Реестры}.
Объём выгрузки: 164.24 Мб.
Формирование (секунд): 340, 465, 299, 292, 272 (среднее 333.6).

\textit{REST}.
Объём выгрузки: 253.97 Мб.
Формирование (секунд): 299, 308, 285, 268, 254 (среднее 282.8).

\textit{SOAP}.
Объём выгрузки: 454.22 Мб.
Формирование (секунд): 605, 710, 686, 385, 445 (среднее 566.2).

\subsubsection*{Ожидаемые и полученные результаты}

TODO

\subsubsection*{Выводы}

TODO

\clearpage
\newpage